<div class="container mx-auto px-5 bg-gray-200" data-controller="entry-modal">
  <% if current_user.admin? %>
    <div class="flex justify-end">
      <%= link_to '編集', edit_calendar_path(@calendar), class: 'bg-blue-500 text-white px-4 py-2' %>
    </div>
  <% end %>

  <div class="bg-gray-400 p-2 mb-4">
    <h1 class="text-3xl font-bold"><%= @calendar.title %></h1>
  </div>

  <div class="prose bg-white mx-auto max-w-full p-2">
      <%= markdown_to_html(@calendar.description) %>
  </div>

  <div class="bg-gray-400">
    <%= turbo_frame_tag 'entry_modal' %>
    <div id="calendar">
      <%= render 'calendar', calendar: @calendar %>
    </div>
  </div>

<div class="space-y-2">
  <% @calendar.entries.order(:registration_date).group_by(&:registration_date).each do |date, entries| %>
    <div class="border border-gray-300 p-4 rounded-lg bg-white shadow-sm">
      <% entries.reverse.each_with_index do |entry, index| %>
        <div class="p-4 flex gap-4 <%= 'border-t border-gray-200' unless index.zero? %>">
          <div class="text-gray-700 font-semibold w-6 text-left">
            <%= entry.registration_date.strftime('%-d') if index.zero? %>
          </div>

          <div class="flex-1 space-y-4">
            <div class="flex items-center space-x-2">
              <%= image_tag "#{request.base_url}#{entry.user.avatar_url}", class: 'w-8 h-8 rounded-full' %>
              <span class="text-sm font-semibold text-gray-900"><%= entry.user.name %></span>
            </div>

            <div class="font-semibold text-gray-900">
              <%= entry.title %>
            </div>

            <% if entry.url.present? %>
              <%= link_to entry.url,
                          class: 'block border rounded-lg shadow-sm hover:shadow-lg flex items-center p-4 space-x-4' do %>
                <div class="flex-1">
                  <h3 class="font-semibold text-gray-900">
                    <%= entry.meta_title %>
                  </h3>
                  <p class="text-gray-600 text-sm mt-1">
                    <%= truncate(entry.meta_description, length: 60) %>
                  </p>
                </div>
                <%= image_tag entry.meta_image_url, class: 'w-32 h-20 object-cover rounded-md' if entry.meta_image_url %>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
</div>
